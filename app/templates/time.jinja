{% extends 'base.jinja' %}

{% block title %}
<title>eTalonu validācijas - Braucieni stundā</title>
{% endblock title %}

{% block head %}
{{ super() }}
<script src='https://unpkg.com/chart.js@4.4.3/dist/chart.umd.js'
    integrity='sha512-LUpacDQOhzI4MVomIbJOUbdKypLvklsznjLrjD9GwzynjSlF7qLy112SzTw+ZWJPxhBvNRLGGdW/7E1slOvsFA=='
    crossorigin='anonymous' defer></script>
{% endblock head %}

{% block page_content %}
<form>
    {{ form.start_date.label(class_='form-label') }}
    {{ form.start_date(class_='form-control') }}
    {{ form.end_date.label(class_='form-label') }}
    {{ form.end_date(class_='form-control') }}
    {{ form.submit(class_='btn btn-primary') }}
</form>

<canvas id='validationsByHourChart' x-init='$nextTick(() => {newChart()})'></canvas>
{% endblock page_content %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/newChart.js') }}" defer></script>
<script>
    async function newChart() {
        const response = await fetch('{{ data_url }}');
        const validations = await response.json();
        const labels = validations.labels;
        const datasets = validations.datasets;
        const visiMarsrtutiDataset = [datasets.find(dataset => dataset.label === 'Visi maršruti')];
        createChart('validationsByHourChart', labels, visiMarsrtutiDataset);
    }
</script>
{% endblock scripts %}